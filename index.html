<!DOCTYPE html>  
<html lang="kr"> 
    <head>
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-1GFEQFHRHR"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
        
          gtag('config', 'G-1GFEQFHRHR');
        </script>
                    
        <title>2025 유치원 급식 사생대회</title>
        <!-- 나눔스퀘어 라운드 폰트 -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-round.css" rel="stylesheet">
        
        <link href="assets/css/index.css" rel="stylesheet"/>
        <link href="assets/css/prize_sector.css" rel="stylesheet"/>
        <link href="assets/css/footer.css" rel="stylesheet"/>
        
        <!-- Font Awesome 아이콘 라이브러리 -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        
        <!-- 검색 컨테이너 스타일 -->
        <style>
           .entry-search {
                font-size: 16px; /* iOS 줌 방지 */
                padding: 8px 40px 8px 14px;
                height: 40px;
                line-height: 1.4;
            }
                
            .search-btn {
                width: 40px;
                height: 40px;
                font-size: 14px;
                border-radius: 10px;
            }
                
            .search-clear-btn {
                right: 10px;
            }
            .search-container {
                display: flex;
                align-items: center;
                width: 100%;
                max-width: 320px;
                margin: 20px 0;
                gap: 10px;
            }
            
            .input-wrapper {
                position: relative;
                flex: 1;
            }
            
            .entry-search {
                width: 100%;
                padding: 10px 45px 10px 16px;
                border: 2px solid #e0e0e0;
                border-radius: 25px;
                font-size: 14px;
                outline: none;
                transition: border-color 0.3s ease;
                box-sizing: border-box;
                height: 44px;
                line-height: 1.4;
                vertical-align: middle;
            }
            
            .entry-search:focus {
                border-color: #6366f1;
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            }
            
            .search-btn {
                background: #647937;
                border: none;
                border-radius: 12px;
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                color: white;
                font-size: 16px;
                flex-shrink: 0;
            }
            
            .search-btn:hover {
                background: #5a6b31;
                transform: scale(1.05);
            }
            
            .search-clear-btn {
                position: absolute;
                right: 12px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                color: #999;
                cursor: pointer;
                display: none;
                font-size: 16px;
                padding: 4px;
                width: 24px;
                height: 24px;
                transition: color 0.2s ease;
                border-radius: 50%;
            }
            
            .search-clear-btn:hover {
                color: #666;
                background: #f5f5f5;
            }
            
            @media (max-width: 768px) {
                .search-container {
                    max-width: 280px;
                    margin: 15px 0;
                    gap: 8px;
                }
                
                .entry-search {
                    font-size: 16px; /* iOS 줌 방지 */
                    padding: 8px 50px 8px 14px;
                    height: 40px;
                    line-height: 1.4;
                }
                
                .search-btn {
                    width: 40px;
                    height: 40px;
                    font-size: 14px;
                    border-radius: 10px;
                }
                
                .search-clear-btn {
                    right: 18px;
                }
            }
        </style>
        <!-- Supabase 라이브러리 추가 -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <meta property="og:title" content="2025 유치원 급식 사생대회">
        <meta property="og:image" content="assets/images/main.jpg">
        <meta property="og:image:width" content="768">
        <meta property="og:image:height" content="1024">
        <meta property="og:description" content="한국교육환경보호원 주최《유치원 급식동화》">
        <meta name="viewport" content="width=device-width, initial-scale=0.75">
    </head>
    <body>
        <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WZ3BSFN6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
        <div class="menu">
            <div class="menu-item">
                <a href="#exhibition-intro">전시소개</a>
            </div>
            <div class="menu-item awards">
                <a href="#exhibition-info">수상작</a>
            </div>
            <div class="menu-item works">
                <a href="#exhibition-works">출품작</a>
            </div>
        </div>
        <div class="landing">
            <div class="landing-info">
                <img src="assets/images/title.svg" alt="유치원급식 사생대회 무럭무럭 냠냠" class="title"/>
                
                <!-- 전시 기간 -->
                <div class="ex-days">2025.09.10 ~ 2025.12.10</div>

                <!-- 입장 버튼 -->
                <a href="#" class="btn" id="enter-gallery-btn">
                    <span class="btn-text">전시입장</span>
                </a>
                
            </div>

        </div>   
        <div class="intro-container"> 
        <div class="intro">
            <div class="intro-inner">
            <h2>전시소개</h2>
                <p>
                    한국교육환경보호원에서 주최한 유치원급식 현장소통단 사생대회 <b>‘우리 유치원 급식 동화’</b>는<br>
                    건강한 식생활과 안전한 급식문화 확산을 지원하고 건강한 유치원 급식에 대한<br>
                    관심과 이해를 높여 <b>식생활 교육을 실천</b>을 목적으로 개최하였습니다.<br>
                </p>
                <p>
                    유치원 원아와 학부모님들의 성원으로 총 <b>220작품</b>이 응모되어 총 <b>17작품</b>을 선정하였습니다.<br>
                    창의적인 급식 이야기를 통해 건강한 유치원 급식 문화에 대한<br>
                    공감과 이해가 더욱 깊어지기를 바랍니다.<br>
                </p>
            <!-- <img src="assets/images/bg/intro-bg.png" class="intro-bg"/> -->
            </div>
        </div>
        <div class="submission-status">
                <!-- 원아부문 -->
                <div class="section baby-section">
                    <div class="section-title">유치원 원아</div>
                    
                    <div class="numbers-container">
                        <div class="number">160 <p class="category">동시</p></div>
                        <div class="number">16 <p class="category">동시</p></div>
                        <div class="number">30 <p class="category">네컷만화</p></div>
                        
                    </div>
                
                </div>

                <!-- 구분선 -->
                <div class="divider"></div>

                <!-- 성인부문 -->
                <div class="section adult-section">
                    <div class="section-title">유치원 교직원 및 학부모</div>
                    
                    <div class="numbers-container">
                        <div class="number">8<p class="category">글·시</p></div>
                        <div class="number">3<p class="category">네컷사진</p></div>
                        <div class="number">5<p class="category">사례</p></div>
                    </div>
                    
                </div>
        </div>
    </div>
            <div class="prize1st-wrapper">
                <div class="prize1st-sector">
                    <div class="part">
                        <div class="cong">
                            <img src="assets/images/cong_img.png" alt=" 수상을 진심으로 축하합니다!" class="cong-img"/>
                            <span class="cong-text">수상을 진심으로 축하드립니다!</span>
                        </div>
                        <div class="prize-sector">
                            <div class="prize-name">
                                <img src="assets/images/winner.png" alt="대상"/>
                                <!-- <span class="prize-name-text">대상</span> -->
                            </div>
                            <div class="work-sec">
                                <img src="assets/images/work_shadow.png" class="work-shadow"/>
                                <img src="assets/images/works/그림일기/[그림일기] 금란자연유치원_엄채원_optimized.jpg" alt="대상 수상작" class="work"/>
                                <img src="assets/images/kid.png" class="kid-img"/>
                            </div>
                            <div class="winner-info">
                                <div class="bg-sec">
                                    <span class="sec-text">그림일기</span>
                                </div>
                                <span class="kindergarten">금란자연유치원</span>
                                <span class="winner-name-gold">엄 채 원</span>
                            </div>
                        </div>

                    </div>
                </div>               
            </div>
            <div class="prize_sector gold-bg">
                <div class="gold_sec_container">
                    <div class="sec-title">
                        <img src="assets/images/gold.png" alt="금상" class="prize-names"/>
                        <!-- <span class="prize-text-style">금상</span> -->
                    </div>
                
                <div class="gold-4-list">
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <div class="kindergarten-info">
                                <span class="kindergarten">충북 무럭냠냠유치원</span>
                            </div>
                                <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                </div>
                </div>
            </div>
            <div class="bg-url">
            <div class="prize_sector silver-bg">
                <div class="silver-container">
                    <div class="sec-title">
                        <img src="assets/images/silver.png" alt="은상" class="prize-names"/>
                        
                    </div>
                
                <div class="silver-list">
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <div class="kindergarten-info">
                                <span class="kindergarten">충북 무럭냠냠유치원</span>
                            </div>
                                <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-gold"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                </div>
                </div>
            </div>
            <div class="prize_sector bronze-bg">
                <div class="silver-container">
                    <div class="sec-title">
                        <img src="assets/images/bronze.png" alt="동상" class="prize-names"/>
                        
                    </div>
                
                <div class="bronze-list">
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <div class="kindergarten-info">
                                <span class="kindergarten">충북 무럭냠냠유치원</span>
                            </div>
                                <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec hide"></div>                 
                    <div class="sec hide"></div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                    <div class="sec">
                        <img src="assets/images/work.png" class="work-img-b"/>
                        <div class="winner-info-gold">
                            <div class="bg-sec">
                                <span class="sec-text">그림 일기</span>
                            </div>
                            <span class="kindergarten">충북 무럭냠냠유치원</span>
                            <span class="winner-name-gold">김 철 수</span>
                        </div>
                        
                    </div>
                </div>
                </div>
            </div>
            <div class="prize_sector bronze-bg goodkindergarten">
                <div class="silver-container">
                    <div class="sec-title">
                        <img src="assets/images/goodex.png" alt="우수유치원" class="prize-names"/>
                    </div>
                    <div class="ex-list goodex"></div>
                            </div>

                        </div>
                        
                    </div>
                        
                    </div>
                </div>
                </div>
            </div>
            <div class="entry entry-bg">
                <div class="entry-sector">
                    <span class="entry-text">출품작</span>
                    <div class="search-container">
                        <div class="input-wrapper">
                            <input type="text" class="entry-search" id="entry-search-input" placeholder="유치원 또는 출품자 이름">
                            <button class="search-clear-btn" id="search-clear-btn" onclick="clearSearch()" style="display: none;">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                        <button type="button" class="search-btn" onclick="performSearch()">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </button>
                    </div>
                    <div class="sector-list">
                        <button class="sector-item active" onclick="selectCategory(this, '그림일기')">그림일기</button>
                        <button class="sector-item" onclick="selectCategory(this, '동시')">동시</button>
                        <button class="sector-item" onclick="selectCategory(this, '네컷만화')">네컷만화</button>
                        <button class="sector-item" onclick="selectCategory(this, '글·시')">글·시</button>
                        <button class="sector-item" onclick="selectCategory(this, '네컷사진')">네컷사진</button>
                        <button class="sector-item" onclick="selectCategory(this, '사례')">사례</button>
                    </div>
                    <div class="entry-work-list">
                        <img src="assets/images/work.png" class="work-img-b"/>
                    </div>
                </div>
            </div>
            </div>
        </body>
        <footer class="footer">
            <div class="footer-container">
                <!-- Logo Section -->
            <div class="info">
                <div class="footer-logo">
                    <img src="assets/icons/logo.svg" alt="유치원급식 사생대회 무럭무럭 냠냠"/>
                </div>
    
                <!-- Main Content -->
                <div class="footer-content">
                    <!-- Organization Info -->
                    <div class="footer-section">
                        <h3 class="footer-section-title">한국교육환경보호원</h3>
                        
                        <div class="footer-info-item">
                            <span class="footer-label">주소</span>
                            <span class="footer-text">충청북도 청주시 흥덕구 오송읍 오송생명로 267-4 3층</span>
                        </div>
                        
                        <div class="footer-info-item">
                            <span class="footer-label">전화</span>
                            <span class="footer-text">043-710-4000</span>
                        </div>
                        
                        <div class="footer-info-item">
                            <span class="footer-label">팩스</span>
                            <span class="footer-text">043-710-4004</span>
                        </div>
                    </div>
                </div>
            </div>
                <!-- SNS Section -->
                <div class="footer-sns">
                    <a href="https://www.instagram.com/sfs_keepa/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
                        <img src="assets/icons/insta.svg" alt="Instagram" class="sns-icon" />
                    </a>
                    <div class="footer-copyright">
                        Copyright©2025 KEEPA. All rights reserved.
                    </div>
                </div>

            </div>
    
            <!-- Bottom Section -->
            <div class="footer-bottom">
                <div class="footer-logos">
                    <a href="https://www.moe.go.kr/main.do?s=moe" target="_blank" rel="noopener noreferrer" aria-label="교육부">
                        <img src="assets/icons/gov-logo.svg" alt="교육부"/>
                    </a>
                    
                    <a href="https://www.schoolkeepa.or.kr/" target="_blank" rel="noopener noreferrer" aria-label="한국교육환경보호원">
                        <img class="edus-logo" src="assets/icons/edu-17-logo.svg" alt="17개 시·도교육청"/>
                    </a>
                    
                    <a href="https://www.cbe.go.kr/cbe/main.do" target="_blank" rel="noopener noreferrer" aria-label="충청북도교육청">
                        <img src="assets/icons/main.svg" alt="한국교육환경보호원"/>
                    </a>
                </div>
            </div>
        </footer>

    <!-- 스크립트들 로드 -->
    <script>
        // Supabase 클라이언트 전역 생성 (한 번만)
        const SUPABASE_URL = 'https://pimgwrosozsowpetqeeq.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBpbWd3cm9zb3pzb3dwZXRxZWVxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0MTcxMjgsImV4cCI6MjA3MDk5MzEyOH0.VKEsxMu47TDVvV93Gy9I-z4UmfNYlNEhSYkBSS5vDqU';
        
        // 전역 Supabase 클라이언트 인스턴스 (페이지당 한 번만 생성)
        window.globalSupabaseClient = null;
        
        // Supabase 클라이언트 초기화 함수
        function initSupabaseClient() {
            if (!window.globalSupabaseClient && window.supabase && typeof window.supabase.createClient === 'function') {
                window.globalSupabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                // console.log('Supabase 클라이언트 초기화 완료');
            }
            return window.globalSupabaseClient;
        }

        // 댓글 섹션 HTML 생성
        function createCommentSection(itemId) {
            // itemId를 안전한 CSS 선택자용 ID로 변환
            const safeId = itemId.replace(/[^a-zA-Z0-9_-]/g, '_');
            
            const container = document.createElement('div');
            container.className = 'comment-section';
            container.innerHTML = `
                <h3>댓글 <span class="comment-count" id="comment-count-${safeId}">(0)</span></h3>
                
                <div class="comments-list" id="comments-list-${safeId}">
                    <div class="no-comments">작성된 댓글이 없습니다.</div>
                </div>
                
                <div class="comment-form">
                                     <input 
                        type="text"
                        id="comment-author-${safeId}"
                        placeholder="작성자 이름"
                        maxlength="8"
                        class="comment-author-input stylish-author-input"
                        style="margin-bottom:12px;width:100%;box-sizing:border-box;border-radius:8px;padding:12px 16px;border:1.5px solid #d1d5db;font-size:16px;background:#f8f9fa;transition:border-color 0.2s;"
                        /* 예쁜 작성자 입력박스 스타일 */
                        .stylish-author-input::placeholder {
                            color: #b0b0b0;
                            font-size: 15px;
                            font-family: 'Pretendard', 'NanumSquareRound', sans-serif;
                            opacity: 1;
                        }
                        .stylish-author-input:focus {
                            border-color: #007bff;
                            background: #fff;
                            outline: none;
                        }
                                            />
                    <textarea 
                        id="comment-content-${safeId}" 
                        placeholder="댓글을 작성해주세요 (최대 300자)" 
                        maxlength="300"
                        rows="3"
                    ></textarea>
                    <div class="comment-form-bottom">
                        <span class="char-count" id="char-count-${safeId}">0/300</span>
                        <button class="comment-submit" onclick="submitComment('${itemId}')">댓글 작성</button>
                    </div>
                </div>
            `;
            
            // 글자 수 카운터 이벤트 리스너 추가
            const textarea = container.querySelector(`#comment-content-${safeId}`);
            const charCount = container.querySelector(`#char-count-${safeId}`);
            const submitBtn = container.querySelector('.comment-submit');
            
            if (textarea && charCount && submitBtn) {
                textarea.addEventListener('input', function() {
                    const length = this.value.length;
                    charCount.textContent = `${length}/500`;
                    charCount.className = length > 450 ? 'char-count warning' : 'char-count';
                    submitBtn.disabled = length === 0 || length > 500;
                });
            } else {
                console.error('일부 요소를 찾을 수 없습니다');
            }
            
            return container;
        }

        // 댓글 불러오기 (Supabase 연결)
        async function loadComments(itemId) {
            
            // itemId를 안전한 CSS 선택자용 ID로 변환
            const safeId = itemId.replace(/[^a-zA-Z0-9_-]/g, '_');
            
            const commentsList = document.getElementById(`comments-list-${safeId}`);
            const commentCount = document.getElementById(`comment-count-${safeId}`);
            
            try {
                // 전역 Supabase 클라이언트 사용
                const supabaseClient = initSupabaseClient();
                
                if (supabaseClient) {
                    const { data: comments, error } = await supabaseClient
                        .from('comments')
                        .select('*')
                        .eq('item_id', itemId)
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        console.error('Supabase 댓글 로드 오류:', error);
                        throw error;
                    }
                    
                    if (commentCount) {
                        commentCount.textContent = `(${comments.length})`;
                    }
                    
                    if (commentsList) {
                        if (comments.length === 0) {
                            commentsList.innerHTML = '<div class="no-comments">아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</div>';
                        } else {
                            commentsList.innerHTML = comments.map(comment => {
                                const date = new Date(comment.created_at).toLocaleString('ko-KR', {
                                    year: 'numeric',
                                    month: 'short',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                });
                                // HTML 이스케이프
                                const escapeHtml = (text) => {
                                    const map = {
                                        '&': '&amp;',
                                        '<': '&lt;',
                                        '>': '&gt;',
                                        '"': '&quot;',
                                        "'": '&#039;'
                                    };
                                    return text.replace(/[&<>"]'/g, function(m) { return map[m]; });
                                };
                                return `
                                    <div class="comment-item" style="display:flex;justify-content:space-between;align-items:center;">
                                        <div style="flex:1;">
                                            <div class="comment-content">${escapeHtml(comment.content)}</div>
                                            <div class="comment-date">${date}</div>
                                        </div>
                                        <div class="comment-author" style="margin-left:16px;color:#888;font-size:13px;white-space:nowrap;">${escapeHtml(comment.author || '')}</div>
                                    </div>
                                `;
                            }).join('');
                        }
                    }
                    
                } else {
                    throw new Error('Supabase 라이브러리가 로드되지 않았습니다');
                }
                
            } catch (error) {
                console.error('댓글 로드 실패:', error);
                
                if (commentsList) {
                    commentsList.innerHTML = '<div class="no-comments">아직 댓글이 없습니다. 첫 댓글을 작성해보세요!</div>';
                }
                if (commentCount) {
                    commentCount.textContent = '(0)';
                }
            }
        }

        // 댓글 작성 (Supabase 연결)
        async function submitComment(itemId) {
            // console.log('submitComment 호출됨:', itemId);
            
            // 안전한 ID로 변환
            const safeId = itemId.replace(/[^a-zA-Z0-9_-]/g, '_');
            const contentElement = document.getElementById(`comment-content-${safeId}`);
            const authorElement = document.getElementById(`comment-author-${safeId}`);
            if (!contentElement || !authorElement) {
                console.error('댓글 입력 요소를 찾을 수 없습니다');
                return;
            }
            const content = contentElement.value.trim();
            const author = authorElement.value.trim();
            if (!author) {
                alert('작성자 이름을 입력해주세요.');
                return;
            }
            if (!content) {
                alert('댓글 내용을 입력해주세요.');
                return;
            }
            if (content.length > 500) {
                alert('댓글은 500자 이내로 작성해주세요.');
                return;
            }
            
            // Supabase를 통한 실제 댓글 저장 시도
            try {
                // 전역 Supabase 클라이언트 사용
                const supabaseClient = initSupabaseClient();
                
                if (supabaseClient) {
                    // console.log('Supabase에 댓글 저장 시도...');
                    const { data, error } = await supabaseClient
                        .from('comments')
                        .insert([
                            {
                                item_id: itemId,
                                content: content,
                                author: author
                            }
                        ]);
                    
                    if (error) {
                        console.error('Supabase 오류:', error);
                        throw error;
                    }
                    
                    // console.log('댓글 저장 성공:', data);
                    
                    // 댓글 입력창 초기화
                    contentElement.value = '';
                    const charCount = document.getElementById(`char-count-${safeId}`);
                    if (charCount) {
                        charCount.textContent = '0/500';
                        charCount.className = 'char-count';
                    }
                    
                    const submitBtn = contentElement.parentElement.querySelector('.comment-submit');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                    }
                    
                    // 댓글 목록 새로고침
                    await loadComments(itemId);
                    
                } else {
                    throw new Error('Supabase 라이브러리가 로드되지 않았습니다');
                }
                
            } catch (error) {
                console.error('댓글 저장 실패:', error);
                alert('댓글 저장 중 오류가 발생했습니다. Supabase 설정을 확인해주세요.');
            }
        }

        // 전역 함수로 등록
        window.createCommentSection = createCommentSection;
        window.loadComments = loadComments;
        window.submitComment = submitComment;

        // 검색 기능 개선 - 버튼 클릭 방식
        function performSearch() {
            const searchInput = document.getElementById('entry-search-input');
            const searchTerm = searchInput.value.trim();
            
            // 기존 filterWorks 로직 실행
            if (window.originalFilterWorks) {
                window.originalFilterWorks(searchTerm);
            }
            
            // X 버튼 표시/숨김
            const clearBtn = document.getElementById('search-clear-btn');
            if (searchTerm !== '') {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
                showAllWorks();
            }
        }

        function filterWorks(searchTerm) {
            // 이 함수는 이제 performSearch에서만 호출됨
            const clearBtn = document.getElementById('search-clear-btn');
            
            // X 버튼 표시/숨김
            if (searchTerm.trim() !== '') {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
            
            // 기존 filterWorks 로직 실행
            if (window.originalFilterWorks) {
                window.originalFilterWorks(searchTerm);
            }
            
            // 검색어가 비어있으면 모든 작품 표시
            if (searchTerm.trim() === '') {
                showAllWorks();
            }
        }

        // 검색 초기화 함수
        function clearSearch() {
            const searchInput = document.getElementById('entry-search-input');
            const clearBtn = document.getElementById('search-clear-btn');
            
            searchInput.value = '';
            clearBtn.style.display = 'none';
            
            // 모든 작품 표시
            showAllWorks();
            
            // 기존 filterWorks 로직도 실행
            if (window.originalFilterWorks) {
                window.originalFilterWorks('');
            }
        }

        // 모든 작품 표시 함수
        function showAllWorks() {
            // 현재 선택된 카테고리의 모든 작품을 표시
            const activeCategory = document.querySelector('.sector-item.active');
            if (activeCategory && window.selectCategory) {
                const categoryName = activeCategory.textContent.trim();
                window.selectCategory(activeCategory, categoryName);
            }
        }

        // 탭 전환 시 검색 초기화
        function selectCategory(element, category) {
            // 기존 selectCategory 함수가 있다면 실행
            if (window.originalSelectCategory) {
                window.originalSelectCategory(element, category);
            }
            
            // 검색 초기화
            clearSearch();
        }

        // 전역 함수로 등록
        window.performSearch = performSearch;
        window.filterWorks = filterWorks;
        window.clearSearch = clearSearch;
        window.selectCategory = selectCategory;
    </script>
    <script src="assets/js/comments.js"></script>
    <script src="assets/js/awards.js"></script>
    <script src="assets/js/works.js"></script>
    <script src="assets/js/navigation.js"></script>
    
    <!-- 기존 함수들 백업 및 새로운 함수 오버라이드 -->
    <script>
        // 페이지 로드 후 기존 함수들을 백업
        document.addEventListener('DOMContentLoaded', function() {
            // Supabase 클라이언트 초기화
            initSupabaseClient();
            
            // 기존 함수들 백업
            if (typeof window.filterWorks !== 'undefined') {
                window.originalFilterWorks = window.filterWorks;
            }
            if (typeof window.selectCategory !== 'undefined') {
                window.originalSelectCategory = window.selectCategory;
            }
            
            // 검색 입력 필드에 이벤트 리스너 추가
            const searchInput = document.getElementById('entry-search-input');
            if (searchInput) {
                // Enter 키 감지
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        performSearch();
                    }
                });
                
                // 실시간 검색 제거 - 버튼 클릭이나 Enter 키로만 검색
            }
            
            // 탭 버튼들에 클릭 이벤트 추가
            const categoryButtons = document.querySelectorAll('.sector-item');
            categoryButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // 기존 active 클래스 제거
                    categoryButtons.forEach(btn => btn.classList.remove('active'));
                    // 현재 버튼에 active 클래스 추가
                    this.classList.add('active');
                    
                    // 검색 초기화
                    clearSearch();
                });
            });
        });
    </script>
    </html>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const enterGalleryBtn = document.getElementById('enter-gallery-btn');
        if (enterGalleryBtn) {
            enterGalleryBtn.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'art-gallery/model.html';
            });
        }
    });
    </script>
</html>













